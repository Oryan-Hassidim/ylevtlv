<!DOCTYPE html>
<html>

<head>
    <title>שרשרת האחדות</title>
    <link rel="icon" href="/logo.svg">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8" />
    <link href="https://fonts.googleapis.com/css2?family=Amatic+SC:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Bellefair&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/lib/bootstrap/dist/css/bootstrap.rtl.min.css" />
    <link href="/lib/jquery-ui/jquery-ui.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="/styles.css" />
    <meta property="og:title" content="שרשרת האחדות" />
    <meta property="og:site_name" content="שרשרת האחדות" />
    <meta property="og:url" content="https://did.li/aJCCN" />
    <meta property="og:description" content="מתאחדים לזכרם" />
    <meta property="og:image" content="https://ylevtlv.z1.web.core.windows.net/images/chain.jpg" />
    <style>
        body {
            background-image: url("/images/chain.jpg");
            background-size: cover;
        }

        .content {
            display: grid;
            grid-template-areas:
                'title'
                'links'
                'register-form';
            justify-content: stretch;
            align-items: center;
            position: absolute;
            top: 0;
            left: 0;
            min-height: 100%;
            min-width: 100%;
        }

        .register-form {
            display: none;
            background: linear-gradient(45deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0.1));
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            border-radius: 1em;
            border: 1px solid rgba(255, 255, 255, 0.4);
            margin: 5%;
            grid-area: register-form;
        }

        .links {
            grid-area: links;
            text-align: center;
            font-size: 2em;
        }

        .links a {
            color: black;
        }

        .title {
            grid-area: title;
            text-align: center;
            margin: 5%;
        }

        @media (min-width: 768px) {
            body {
                background-position: center;
            }

            .content {
                grid-template-columns: 1fr 1fr;
                grid-template-rows: 1.5fr 1fr;
                grid-template-areas:
                    'none register-form'
                    'links register-form';
                height: 100%;
            }

            .title {
                display: none;
            }
        }

        .register-form label {
            color: black;
        }

        .register-form select {
            background-color: transparent;
        }

        #needRide,
        #notNeedRide {
            display: inline-block;
            margin-top: 1em;
            height: 1em;
            width: 1em;
            transform: translateY(0.1em);
        }

        #needRide+label,
        #notNeedRide+label {
            display: inline-block;
            margin-right: 0.5em;
            font-size: 1.2em;
            color: #1d1d1d;
        }

        #needRide+label+input,
        #needRide+label+input+label {
            display: none;
        }

        #needRide:checked+label+input,
        #needRide:checked+label+input+label {
            display: initial;
        }

        .size {
            margin-bottom: 0.1em;
        }

        .register-form input[type=text],
        .register-form input[type=number],
        .register-form textarea {
            border-bottom: 1px solid #008fd7;
        }

        .register-form input[type=submit] {
            border: 1px solid #008fd7;
            color: #00537c;
            background: linear-gradient(120deg, transparent 33%, #008fd7 50%, transparent 66%);
            background-size: 300% 100%;
            background-position-x: 0%;
        }

        .register-form input[type=submit]:focus,
        .register-form input[type=submit]:hover {
            border: 1px solid white;
            box-shadow: 0 0 20px 15px #008fd7;
            color: #00324c;
        }

        .spinner {
            filter: drop-shadow(2px 2px 1px #008fd7D0) drop-shadow(2px -2px 1px #008fd7D0) drop-shadow(-2px -2px 1px #008fd7D0) drop-shadow(-2px 2px 1px #008fd7D0);
        }

        .spinner circle {
            stroke: #008fd7;
        }
    </style>
</head>

<body dir="rtl">
    <div class="content">
        <div class="title">
            <h1>שרשרת האחדות</h1>
            <h2>מתאחדים לזכרם</h2>
        </div>
        <div class="register-form">
            <form id="registerForm">
                <div>
                    <input id="name" type="text" required name="name" />
                    <label for="name">שמך</label>
                </div>
                <div>
                    <input id="phone" type="text" required name="phone" />
                    <label for="phone">מס' נייד</label>
                </div>
                <div>
                    <input id="count" type="number" required name="count" value="1" />
                    <label for="count">כמות</label>
                </div>
                <div>
                    <input type="radio" id="notNeedRide" name="needRide" checked>
                    <label for="notNeedRide">אגיע ברכב / בתחבורה ציבורית לאחד מהחניונים</label>
                    <br />
                    <input type="radio" id="needRide" name="needRide" style="margin-top: 0;">
                    <label for="needRide">אני צריך הסעה</label>
                    <input id="location" type="text" name="location" />
                    <label for="location">מאיפה אתה צריך הסעה?</label>
                </div>
                <div id="sizes">
                    <label for="size">מידת חולצה:</label>
                    <select class="size form-select" required aria-label="Default select example">
                        <option value="" selected>בחר מידה מהרשימה</option>
                        <option value="XS">XS</option>
                        <option value="S">S</option>
                        <option value="M">M</option>
                        <option value="L">L</option>
                        <option value="XL">XL</option>
                        <option value="XXL">XXL</option>
                    </select>
                </div>
                <div>
                    <textarea id="notes" name="notes" value=" "></textarea>
                    <label for="notes" style="bottom: 0.5em">הערה (אופציונלי)</label>
                </div>
                <div id="sumbitDiv">
                    <div class="spinner">
                        <!--invisible-->
                        <svg>
                            <circle r="20" cx="22" cy="22"></circle>
                        </svg>
                    </div>
                    <input id="submit" type="submit" value="שלח" />
                </div>
            </form>
        </div>
        <div class="links">
            <a href="https://givechak.co.il/43306" class="btn btn-primary">תרומה</a>
            <button id="showRegisterForm" class="btn btn-primary">הרשמה לשרשרת</button>
            <a href="https://chat.whatsapp.com/Kp9h0lJXZQkDKfIa51VJyH" class="btn btn-primary">התנדבות</a>
        </div>
    </div>
    <script src="/lib/jquery/dist/jquery.min.js"></script>
    <script src="/lib/jquery-ui/jquery-ui.min.js"></script>
    <script src="/lib/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="index.js"></script>
    <script>
        // on NeedRide checkbox change, toggle the location input to required
        $("#needRide").change(function () {
            if (this.checked) {
                $("#location").attr("required", "required");
            } else {
                $("#location").removeAttr("required");
            }
        });

        var gselect = $(".size").first().clone();
        $("#count").change(function () {
            // if count is greater than 1, show size select count times
            // create a select element with the same name and id as the original
            // append it to the form
            // if count is less than 1, remove all selects with the same name and id

            var count = parseInt($(this).val());
            if (count < 1) {
                $(this).val(1);
                count = 1;
            }
            if (count > 10) {
                $(".size").remove();
                $("#sizes").append("<p class=\"size\">ניצור איתכם קשר בהקדם!</p>");
                return;
            }
            var select = gselect.clone();
            $(".size").remove();
            for (var i = 0; i < count; i++) {
                select.attr("name", "size" + i);
                select.appendTo("#sizes");
                select = select.clone();
            }
            if (count > 1) {
                $.each(["0-3", "6", "10", "11", "14"], function (i, item) {
                    $('.size').append($('<option>', {
                        value: item,
                        text: item
                    }));
                });
            }
        });

        function chainRegisterForm() {
            const registerForm = $(" #registerForm ");
            registerForm.submit(function (event) {
                event.preventDefault();
                registerForm.find("#submit")
                    .addClass("submitted")
                    .delay(350)
                    .animate({
                        opacity: "0"
                    }, 100);
                registerForm.find(".spinner")
                    .delay(330)
                    .fadeIn();
                // create a dictionary for count any size
                var sizes = {};
                for (var i = 0; i < registerForm.find(".size").length; i++) {
                    var size = registerForm.find(".size")[i];
                    if (sizes[size.value] === undefined) {
                        sizes[size.value] = 1;
                    } else {
                        sizes[size.value]++;
                    }
                }

                var $form = $(this),
                    details = {
                        name: registerForm.find("#name").val(),
                        phone: registerForm.find("#phone").val(),
                        count: parseInt(registerForm.find("#count").val()),
                        size: JSON.stringify(sizes),
                        location: registerForm.find("#needRide").is(":checked") ? registerForm.find("#location").val() : null,
                        notes: registerForm.find("#notes").val() === "" ? null : registerForm.find("#notes").val()
                    },
                    url = "https://ylevtlv.azurewebsites.net/api/chain/register?code=a5IgfO8HLMq4TDzMxCZ7xvM4pqOWpdUGtQFos14vYA_kAzFuLC6_1w==";
                var posting = $.post(url, JSON.stringify(details), function (data) {
                    var h = "";
                    if (data == 204) {
                        h = "<div><p>בקשתך התקבלה ונשתדל לשוב אליך בהקדם🙃</p></div>";
                    } else {
                        h = "<div><p>הייתה בעיה בקשר עם השרתים😒</p><p>נסה אולי לפנות אלינו דרך הוואטסאפ...</p><p>" + data + "</p></div>"
                    }
                    $("#sumbitDiv").html(h);
                });
            });
        }
        chainRegisterForm();

        $("#showRegisterForm").click(function () {
            $(".register-form").fadeIn(500);
        });
    </script>
</body>

</html>